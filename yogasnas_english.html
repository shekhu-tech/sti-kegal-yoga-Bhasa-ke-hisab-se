<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>S.T.I PRO | Yoga System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* === GREEN THEME VARIABLES (BODY) === */
            --bg-deep: #000500;
            --bg-card: rgba(5, 20, 5, 0.9);
            --bg-glass: rgba(255, 255, 255, 0.03);
            
            --theme-neon: #00FF41; /* Matrix/Neon Green */
            --theme-dim: #00661A;
            --theme-glow: 0 0 15px rgba(0, 255, 65, 0.4);
            
            --border-light: rgba(255, 255, 255, 0.1);
            --border-theme: rgba(0, 255, 65, 0.3);

            /* === GOLD THEME VARIABLES (HEADER ONLY) === */
            --header-gold: #FFD700;
            --header-glow: 0 0 15px rgba(255, 215, 0, 0.4);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-deep);
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
            overflow: hidden; 
            /* Green Tinted Background */
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 255, 65, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 102, 26, 0.05) 0%, transparent 20%);
            height: 100dvh;
        }

        .font-mono-tech {
            font-family: 'JetBrains Mono', monospace;
        }

        /* === MAIN CONTAINER (KEGEL STRUCTURE) === */
        .glass-panel {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.9);
            
            height: auto; 
            max-height: 85dvh; 
            width: 100%;
            max-width: 420px;
            
            display: flex;
            flex-direction: column;
            transition: height 0.3s ease;
        }

        /* Green Border Specifics */
        .glass-panel-green {
            border: 1px solid var(--border-theme);
            box-shadow: 0 0 30px -10px rgba(0, 255, 65, 0.2);
        }

        .text-glow {
            text-shadow: var(--theme-glow);
        }
        
        .header-glow {
            text-shadow: var(--header-glow);
        }
        
        /* Custom Scrollbar (Green) */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(0, 255, 65, 0.2); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(0, 255, 65, 0.5); }

        /* Buttons (Green Theme) */
        .btn-tech {
            background: linear-gradient(145deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid var(--border-light);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .btn-tech::before {
            content: '';
            position: absolute;
            top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 65, 0.1), transparent);
            transition: 0.5s;
        }

        .btn-tech:hover {
            border-color: var(--theme-neon);
            box-shadow: var(--theme-glow);
            transform: translateY(-2px);
        }
        
        .btn-tech:hover::before { left: 100%; }
        .btn-tech:active { transform: scale(0.98); }

        .btn-primary-glow {
            background: var(--theme-neon);
            color: #000; /* Black text on neon green */
            font-weight: 800;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.4);
            transition: all 0.3s ease;
        }
        .btn-primary-glow:hover {
            background: #fff;
            color: #000;
            box-shadow: 0 0 30px rgba(0, 255, 65, 0.6);
        }

        /* Exercise Cards (Green Theme) */
        .exercise-card {
            background: linear-gradient(180deg, rgba(255,255,255,0.03) 0%, rgba(0,0,0,0.2) 100%);
            border: 1px solid var(--border-light);
            transition: all 0.3s ease;
            flex-shrink: 0; 
        }
        .exercise-card.current {
            border-color: var(--theme-neon);
            background: linear-gradient(180deg, rgba(0, 255, 65, 0.1) 0%, rgba(0,0,0,0.3) 100%);
            box-shadow: inset 0 0 20px rgba(0, 255, 65, 0.1);
        }
        .exercise-card.completed {
            border-color: #ffffff;
            opacity: 0.6;
        }
        .exercise-card.locked {
            opacity: 0.3;
            filter: grayscale(1);
        }

        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .hud-box { position: relative; }
        .hud-box::after {
            content: ''; position: absolute; bottom: 0; right: 0;
            width: 10px; height: 10px;
            border-bottom: 2px solid var(--theme-neon);
            border-right: 2px solid var(--theme-neon);
        }
        .hud-box::before {
            content: ''; position: absolute; top: 0; left: 0;
            width: 10px; height: 10px;
            border-top: 2px solid var(--theme-neon);
            border-left: 2px solid var(--theme-neon);
        }

        /* === VIDEO MODAL STYLING (Green) === */
        .video-modal-container {
            width: 100%;
            height: auto;
            max-height: 70dvh;
            margin: auto;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border-radius: 16px;
            background: #000;
            box-shadow: 0 0 50px rgba(0,0,0,0.9);
            border: 1px solid var(--theme-dim);
        }

        .video-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(0, 255, 65, 0.3);
        }

        .video-player-wrapper {
            width: 100%;
            aspect-ratio: 16 / 9;
            flex-shrink: 0; 
            background: #000;
            position: relative;
            z-index: 10;
        }

        .video-info-area {
            flex: 1; 
            overflow-y: auto; 
            background: linear-gradient(to top, #000 0%, #051a05 100%);
            display: flex;
            flex-direction: column;
            padding: 16px;
        }

        /* === SIDE RESET BUTTON (Green) === */
        .side-reset-tab {
            position: fixed;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: #000500;
            color: #fff;
            padding: 16px 6px;
            border: 1px solid var(--theme-neon);
            border-right: none;
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
            writing-mode: vertical-rl;
            text-orientation: mixed;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            z-index: 9999;
            box-shadow: -4px 0 15px rgba(0, 255, 65, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* === SCROLL & LAYOUT LOGIC === */
        #app-content {
            display: flex;
            flex-direction: column;
            overflow: hidden; 
        }
        
        .content-scroll-area {
            flex: 1;
            overflow-y: auto; 
            min-height: 0;
            padding: 1.5rem; 
        }

        @media (max-height: 750px) {
            .glass-panel { max-height: 90dvh; }
            .content-scroll-area { padding: 1rem; }
            header { padding-top: 1rem; padding-bottom: 0.5rem; }
            .exercise-card { padding: 0.75rem; margin-bottom: 0.5rem; }
            .exercise-card h4 { font-size: 0.8rem; }
            #question-text { font-size: 1.1rem; margin-bottom: 1rem; }
            .btn-tech { padding: 0.75rem; }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 sm:p-6">

    <div class="fixed inset-0 pointer-events-none opacity-20" style="background-image: linear-gradient(#00FF41 1px, transparent 1px), linear-gradient(90deg, #00FF41 1px, transparent 1px); background-size: 40px 40px;"></div>

    <div class="glass-panel glass-panel-green rounded-3xl overflow-hidden relative animate-fade-in">
        
        <header class="pt-6 pb-4 px-6 text-center border-b border-[#FFD700]/20 relative z-10 shrink-0">
            <div class="inline-block relative">
                <h1 class="text-2xl font-black tracking-tight text-white">
                    S.T.I <span class="header-glow text-[#FFD700]">PRO</span>
                </h1>
                <div class="absolute -bottom-1 left-0 w-full h-[1px] bg-gradient-to-r from-transparent via-[#FFD700] to-transparent"></div>
            </div>
            <p class="text-[9px] font-mono-tech text-gray-400 mt-1 tracking-[0.2em] uppercase">HOLISTIC WELLNESS PARTNER</p>
        </header>

        <main id="app-content" class="relative z-10">
            <div class="content-scroll-area custom-scrollbar">
                
                <div id="progress-section" class="mb-6">
                    <div class="flex justify-between items-end mb-2 font-mono-tech">
                        <span id="step-label" class="text-[10px] text-[#00FF41] tracking-widest uppercase">Initializing...</span>
                        <span id="question-counter" class="text-xs text-white/70">00/10</span>
                    </div>
                    <div class="w-full bg-white/5 h-1.5 rounded-full overflow-hidden shadow-inner">
                        <div id="progress-bar" class="h-full bg-gradient-to-r from-[#00661A] to-[#00FF41] w-0 shadow-[0_0_10px_#00FF41] transition-all duration-500 ease-out"></div>
                    </div>
                </div>

                <div id="quiz-section" class="animate-fade-in flex flex-col justify-center">
                    <h2 id="question-text" class="text-xl md:text-2xl font-bold text-white mb-6 leading-snug drop-shadow-md">
                        System Loading...
                    </h2>
                    <div id="options-container" class="space-y-3">
                        </div>
                </div>

                <div id="analysis-section" class="hidden animate-fade-in pb-4">
                    <div class="text-center mb-6">
                        <div class="inline-block p-3 rounded-full border border-[#00FF41]/30 bg-[#00FF41]/10 mb-3">
                            <i class="fas fa-check text-2xl text-[#00FF41] drop-shadow-[0_0_8px_rgba(0,255,65,0.8)]"></i>
                        </div>
                        <h2 class="text-2xl font-black text-white tracking-tight">ANALYSIS COMPLETE</h2>
                        <p class="text-[10px] font-mono-tech text-gray-400 mt-1">YOGA BIOMETRIC REPORT</p>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 mb-6">
                        <div class="hud-box bg-white/5 p-3 rounded-lg text-center border border-white/5">
                            <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Focus</div>
                            <div id="focus-score" class="text-xl font-mono-tech font-bold text-[#00FF41]">0%</div>
                        </div>
                        <div class="hud-box bg-white/5 p-3 rounded-lg text-center border border-white/5">
                            <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Wellness</div>
                            <div id="wellness-score" class="text-xl font-mono-tech font-bold text-white">0%</div>
                        </div>
                        <div class="hud-box bg-white/5 p-3 rounded-lg text-center border border-white/5">
                            <div class="text-[9px] uppercase text-gray-500 font-bold mb-1 tracking-wider">Target</div>
                            <div id="program-score" class="text-xl font-mono-tech font-bold text-[#00FF41]">0%</div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-br from-[#051a05] to-black border border-[#00FF41]/20 p-5 rounded-xl mb-6 relative overflow-hidden">
                        <div class="absolute top-0 right-0 w-16 h-16 bg-[#00FF41] blur-[40px] opacity-10"></div>
                        <h3 class="text-xs font-bold text-[#00FF41] mb-3 flex items-center gap-2 uppercase tracking-wide">
                            <i class="fas fa-microchip"></i>Result
                        </h3>
                        <p id="analysis-text" class="text-xs text-gray-300 leading-relaxed font-light"></p>
                    </div>
                    
                    <button onclick="showExercisePlan()" class="w-full btn-primary-glow py-4 rounded-xl text-xs uppercase tracking-widest relative overflow-hidden group">
                        <span class="relative z-10">INITIATE YOGA PROTOCOL <i class="fas fa-arrow-right ml-2"></i></span>
                    </button>
                </div>

                <div id="exercise-section" class="hidden animate-fade-in">
                    <div class="flex justify-between items-end mb-4 border-b border-white/10 pb-4 sticky top-0 bg-[#000500]/0 backdrop-blur-sm z-20 pt-1">
                        <div>
                            <h2 class="text-lg font-bold text-white">Daily Protocol</h2>
                            <div class="flex items-center gap-2 mt-1">
                                <span class="w-2 h-2 rounded-full bg-[#00FF41] animate-pulse"></span>
                                <span class="text-[10px] font-mono-tech text-[#00FF41]">DAY <span id="current-day" class="text-lg font-bold">01</span> / 30</span>
                            </div>
                        </div>
                        <div id="completion-stats" class="text-[10px] font-mono-tech text-gray-400 bg-white/5 px-2 py-1 rounded">0/6 TASKS</div>
                    </div>
                    
                    <div id="exercise-list" class="space-y-3 pb-6">
                        </div>
                </div>
            </div>
        </main>
    </div>

    <div id="floating-reset-btn" onclick="restartAssessment()" class="side-reset-tab hidden">
        SYSTEM RESET
    </div>

    <div id="custom-alert-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-sm" onclick="cancelReset()"></div>
        
        <div class="relative bg-[#000500] border border-[#00FF41] p-6 rounded-xl max-w-sm w-full shadow-[0_0_50px_rgba(0,255,65,0.2)] animate-fade-in text-center">
            
            <div class="text-[#00FF41] text-3xl mb-3 drop-shadow-[0_0_10px_rgba(0,255,65,0.6)]">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            
            <h3 class="text-white font-bold text-lg mb-1 font-mono-tech tracking-wider">S.T.I PRO SYSTEM</h3>
            <div class="w-full h-px bg-white/10 my-3"></div>
            
            <p class="text-gray-300 text-xs mb-6 leading-relaxed">
                WARNING: SYSTEM RESET INITIATED.<br>
                All yoga progress data will be permanently wiped.<br><br>
                <span class="text-[#00FF41]">Do you wish to continue?</span>
            </p>
            
            <div class="flex gap-3">
                <button onclick="cancelReset()" class="flex-1 py-3 rounded-lg border border-white/20 text-white text-xs font-bold hover:bg-white/10 transition-colors font-mono-tech">CANCEL</button>
                <button onclick="confirmReset()" class="flex-1 py-3 rounded-lg bg-[#00FF41] text-black text-xs font-bold hover:bg-white hover:text-black transition-colors shadow-[0_0_15px_rgba(0,255,65,0.4)] font-mono-tech">CONFIRM RESET</button>
            </div>
        </div>
    </div>

    <div id="video-modal" class="fixed inset-0 z-50 hidden flex items-center justify-center p-4">
        <div class="absolute inset-0 bg-black/95 backdrop-blur-xl transition-opacity duration-300" onclick="closeVideoModal()"></div>
        
        <div class="video-modal-container z-10 relative animate-fade-in max-w-md">
            
            <div class="video-container">
                <button onclick="closeVideoModal()" class="absolute top-2 right-2 z-20 w-8 h-8 flex items-center justify-center bg-black/50 rounded-full text-white/70 hover:text-white hover:bg-[#00FF41] transition-all border border-white/10">
                    <i class="fas fa-times"></i>
                </button>

                <div class="video-player-wrapper" id="video-frame">
                    </div>
                
                <div class="video-info-area custom-scrollbar">
                    
                    <div class="video-progress h-1 bg-white/10 rounded-full mb-3 overflow-hidden shrink-0">
                        <div id="video-progress-fill" class="h-full bg-[#00FF41] w-0 transition-all duration-300 shadow-[0_0_10px_#00FF41]"></div>
                    </div>
                    
                    <div class="flex justify-between text-[10px] font-mono-tech text-gray-400 mb-4 shrink-0">
                        <span id="video-time-current">0:00</span>
                        <span id="video-time-total">0:00</span>
                    </div>

                    <h3 id="video-title" class="text-base font-bold text-white mb-1 leading-tight">Pose Name</h3>
                    <p id="video-description" class="text-xs text-gray-400 mb-4 leading-relaxed">Description goes here...</p>
                    
                    <div class="grid grid-cols-3 gap-2 mb-5 shrink-0">
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-clock text-[#00FF41] text-[10px] mb-1 block"></i>
                            <span id="video-duration" class="text-[10px] font-mono-tech"></span>
                        </div>
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-redo text-[#00FF41] text-[10px] mb-1 block"></i>
                            <span id="video-reps" class="text-[10px] font-mono-tech"></span>
                        </div>
                        <div class="bg-white/5 p-2 rounded text-center border border-white/5">
                            <i class="fas fa-tag text-[#00FF41] text-[10px] mb-1 block"></i>
                            <span id="video-category" class="text-[9px] uppercase font-bold truncate"></span>
                        </div>
                    </div>
                    
                    <button id="complete-btn" onclick="markCurrentExerciseComplete()" class="w-full btn-primary-glow py-3 rounded-xl text-xs font-bold disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-700 disabled:text-gray-400 disabled:box-shadow-none transition-all shrink-0 mt-auto">
                        <i class="fas fa-circle-notch fa-spin mr-2 hidden" id="video-loading"></i>
                        <span id="complete-btn-text">INITIALIZING STREAM...</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
    // ==================== STATE MANAGEMENT ====================
    let appState = {
        currentQuestion: 0,
        gender: null,
        scores: { flexibility: 0, strength: 0, stress: 0, balance: 0, pain: 0, focus: 0 },
        primaryGoal: "general",
        targetArea: "full_body",
        currentDay: 1,
        dayExercises: {}, 
        dayProgress: {},  
        userProfile: {},
        lastSave: Date.now(),
        videoProgress: {}
    };

    // ==================== STORAGE FUNCTIONS ====================
    function saveState() {
        appState.lastSave = Date.now();
        localStorage.setItem('STIPRO_YOGA_GREEN_DATA', JSON.stringify(appState));
    }

    function loadState() {
        const saved = localStorage.getItem('STIPRO_YOGA_GREEN_DATA');
        if (saved) {
            appState = JSON.parse(saved);
            return true;
        }
        return false;
    }

    // ==================== YOGA LIBRARY ====================
    const yogaLibrary = {
         beginner: [
            {
                id: "B1",
                name: "Mountain Pose (Tadasana)",
                description: "Foundation for all standing poses",
                category: "beginner",
                subcategory: "standing",
                difficulty: "beginner",
                duration: "5:00",
                holds: "3 × 30s",
                videoCode: "9X5_U4D1uDk",
                benefit: "Improves posture, balance, and awareness",
                solution: "Establishes proper alignment for all yoga poses",
                focus: ["posture", "balance"]
            },
            {
                id: "B2",
                name: "Downward Dog (Adho Mukha Svanasana)",
                description: "Full-body stretch and strength",
                category: "beginner",
                subcategory: "inversion",
                difficulty: "beginner",
                duration: "6:15",
                holds: "3 × 30s",
                videoCode: "fD3XitN08nQ",
                benefit: "Stretches hamstrings, calves, spine",
                solution: "Builds shoulder strength and flexibility",
                focus: ["flexibility", "strength"]
            },
            {
                id: "B3",
                name: "Child's Pose (Balasana)",
                description: "Resting pose for stress relief",
                category: "beginner",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "4:30",
                holds: "3 × 60s",
                videoCode: "ub3X7mC-7i4",
                benefit: "Relieves back and neck tension",
                solution: "Calms nervous system, reduces stress",
                focus: ["relaxation", "stress"]
            },
            {
                id: "B4",
                name: "Warrior I (Virabhadrasana I)",
                description: "Foundation for lower body strength",
                category: "beginner",
                subcategory: "standing",
                difficulty: "beginner",
                duration: "5:45",
                holds: "3 × 30s each side",
                videoCode: "bQ8p8pL2eH4",
                benefit: "Strengthens legs, opens hips",
                solution: "Builds stability and focus",
                focus: ["strength", "balance"]
            },
            {
                id: "B5",
                name: "Warrior II (Virabhadrasana II)",
                description: "Hip opening and strength building",
                category: "beginner",
                subcategory: "standing",
                difficulty: "beginner",
                duration: "5:30",
                holds: "3 × 30s each side",
                videoCode: "zQpGZfWqWw4",
                benefit: "Improves hip flexibility, leg strength",
                solution: "Enhances concentration and endurance",
                focus: ["flexibility", "strength"]
            },
            {
                id: "B6",
                name: "Triangle Pose (Trikonasana)",
                description: "Side body stretch and strength",
                category: "beginner",
                subcategory: "standing",
                difficulty: "beginner",
                duration: "6:00",
                holds: "3 × 30s each side",
                videoCode: "Lx7p6Y2qJq4",
                benefit: "Stretches hips, hamstrings, spine",
                solution: "Improves digestion and balance",
                focus: ["flexibility", "balance"]
            },
            {
                id: "B7",
                name: "Cat-Cow Pose (Marjaryasana-Bitilasana)",
                description: "Spinal flexibility and mobility",
                category: "beginner",
                subcategory: "floor",
                difficulty: "beginner",
                duration: "4:45",
                holds: "10 cycles",
                videoCode: "mN3p7q4VvT4",
                benefit: "Improves spinal flexibility",
                solution: "Relieves back pain and tension",
                focus: ["flexibility", "pain"]
            },
            {
                id: "B8",
                name: "Bridge Pose (Setu Bandhasana)",
                description: "Gentle backbend for spine health",
                category: "beginner",
                subcategory: "backbend",
                difficulty: "beginner",
                duration: "5:15",
                holds: "3 × 30s",
                videoCode: "pQrR7qRqRq4",
                benefit: "Strengthens back, glutes, hamstrings",
                solution: "Relieves mild back pain",
                focus: ["strength", "pain"]
            },
            {
                id: "B9",
                name: "Seated Forward Bend (Paschimottanasana)",
                description: "Hamstring and spine stretch",
                category: "beginner",
                subcategory: "seated",
                difficulty: "beginner",
                duration: "5:30",
                holds: "3 × 45s",
                videoCode: "qWrR7qRqRq4",
                benefit: "Calms nervous system",
                solution: "Improves hamstring flexibility",
                focus: ["flexibility", "stress"]
            },
            {
                id: "B10",
                name: "Cobra Pose (Bhujangasana)",
                description: "Gentle backbend for spine strength",
                category: "beginner",
                subcategory: "backbend",
                difficulty: "beginner",
                duration: "4:30",
                holds: "5 × 15s",
                videoCode: "rWrR7qRqRq4",
                benefit: "Strengthens spine, opens chest",
                solution: "Improves posture and lung capacity",
                focus: ["strength", "posture"]
            },
            {
                id: "B11",
                name: "Tree Pose (Vrikshasana)",
                description: "Balance and focus training",
                category: "beginner",
                subcategory: "balance",
                difficulty: "beginner",
                duration: "5:00",
                holds: "3 × 30s each side",
                videoCode: "sWrR7qRqRq4",
                benefit: "Improves balance and concentration",
                solution: "Strengthens legs and core",
                focus: ["balance", "focus"]
            },
            {
                id: "B12",
                name: "Easy Pose (Sukhasana)",
                description: "Meditation foundation pose",
                category: "beginner",
                subcategory: "meditation",
                difficulty: "beginner",
                duration: "7:00",
                holds: "1 × 5:00",
                videoCode: "tWrR7qRqRq4",
                benefit: "Calms mind, improves posture",
                solution: "Establishes meditation practice",
                focus: ["focus", "stress"]
            }
        ],

        // 2️⃣ INTERMEDIATE STRENGTH POSES (10 poses)
        intermediate: [
            {
                id: "I1",
                name: "Plank Pose (Phalakasana)",
                description: "Core and upper body strength",
                category: "intermediate",
                subcategory: "strength",
                difficulty: "intermediate",
                duration: "4:30",
                holds: "3 × 45s",
                videoCode: "sWrR7qRqRq4",
                benefit: "Builds core, arm, shoulder strength",
                solution: "Foundation for arm balances",
                focus: ["strength", "core"]
            },
            {
                id: "I2",
                name: "Chair Pose (Utkatasana)",
                description: "Leg strength and endurance",
                category: "intermediate",
                subcategory: "strength",
                difficulty: "intermediate",
                duration: "5:00",
                holds: "3 × 45s",
                videoCode: "tWrR7qRqRq4",
                benefit: "Strengthens legs, glutes, core",
                solution: "Improves balance and stamina",
                focus: ["strength", "endurance"]
            },
            {
                id: "I3",
                name: "Warrior III (Virabhadrasana III)",
                description: "Advanced balance and strength",
                category: "intermediate",
                subcategory: "balance",
                difficulty: "intermediate",
                duration: "5:30",
                holds: "3 × 30s each side",
                videoCode: "uWrR7qRqRq4",
                benefit: "Improves balance, leg strength",
                solution: "Enhances full-body coordination",
                focus: ["balance", "strength"]
            },
            {
                id: "I4",
                name: "Side Plank (Vasisthasana)",
                description: "Core and oblique strength",
                category: "intermediate",
                subcategory: "strength",
                difficulty: "intermediate",
                duration: "5:15",
                holds: "3 × 30s each side",
                videoCode: "vWrR7qRqRq4",
                benefit: "Strengthens obliques, shoulders",
                solution: "Improves lateral stability",
                focus: ["strength", "core"]
            },
            {
                id: "I5",
                name: "Half Moon Pose (Ardha Chandrasana)",
                description: "Balance and hip opening",
                category: "intermediate",
                subcategory: "balance",
                difficulty: "intermediate",
                duration: "5:45",
                holds: "3 × 30s each side",
                videoCode: "wWrR7qRqRq4",
                benefit: "Improves balance, hip flexibility",
                solution: "Enhances coordination and focus",
                focus: ["balance", "flexibility"]
            },
            {
                id: "I6",
                name: "Camel Pose (Ustrasana)",
                description: "Heart opening backbend",
                category: "intermediate",
                subcategory: "backbend",
                difficulty: "intermediate",
                duration: "6:00",
                holds: "3 × 30s",
                videoCode: "xWrR7qRqRq4",
                benefit: "Opens chest, improves posture",
                solution: "Relieves rounded shoulders",
                focus: ["flexibility", "posture"]
            },
            {
                id: "I7",
                name: "Pigeon Pose (Eka Pada Rajakapotasana)",
                description: "Deep hip opener",
                category: "intermediate",
                subcategory: "hip_opener",
                difficulty: "intermediate",
                duration: "7:00",
                holds: "3 × 60s each side",
                videoCode: "yWrR7qRqRq4",
                benefit: "Releases hip tension, improves flexibility",
                solution: "Relieves lower back pain",
                focus: ["flexibility", "pain"]
            },
            {
                id: "I8",
                name: "Boat Pose (Navasana)",
                description: "Core strength and balance",
                category: "intermediate",
                subcategory: "core",
                difficulty: "intermediate",
                duration: "5:30",
                holds: "5 × 20s",
                videoCode: "zWrR7qRqRq4",
                benefit: "Strengthens core, improves balance",
                solution: "Builds abdominal strength",
                focus: ["strength", "core"]
            },
            {
                id: "I9",
                name: "Wheel Pose (Urdhva Dhanurasana)",
                description: "Full backbend strength",
                category: "intermediate",
                subcategory: "backbend",
                difficulty: "intermediate",
                duration: "6:30",
                holds: "3 × 30s",
                videoCode: "aXrR7qRqRq4",
                benefit: "Opens chest, strengthens spine",
                solution: "Improves spinal flexibility",
                focus: ["strength", "flexibility"]
            },
            {
                id: "I10",
                name: "Crow Pose (Bakasana)",
                description: "Arm balance foundation",
                category: "intermediate",
                subcategory: "arm_balance",
                difficulty: "intermediate",
                duration: "5:45",
                holds: "5 × 15s",
                videoCode: "bXrR7qRqRq4",
                benefit: "Builds arm strength, core stability",
                solution: "Develops balance and focus",
                focus: ["strength", "balance"]
            }
        ],

        // 3️⃣ ADVANCED POSES (8 poses)
        advanced: [
            {
                id: "A1",
                name: "Headstand (Sirsasana)",
                description: "King of all yoga poses",
                category: "advanced",
                subcategory: "inversion",
                difficulty: "advanced",
                duration: "8:00",
                holds: "3 × 60s",
                videoCode: "aXrR7qRqRq4",
                benefit: "Improves circulation, focus",
                solution: "Increases brain oxygenation",
                focus: ["focus", "balance"]
            },
            {
                id: "A2",
                name: "Handstand (Adho Mukha Vrksasana)",
                description: "Full inversion strength",
                category: "advanced",
                subcategory: "inversion",
                difficulty: "advanced",
                duration: "7:30",
                holds: "5 × 20s",
                videoCode: "bXrR7qRqRq4",
                benefit: "Builds shoulder strength, balance",
                solution: "Improves body awareness",
                focus: ["strength", "balance"]
            },
            {
                id: "A3",
                name: "Forearm Stand (Pincha Mayurasana)",
                description: "Advanced inversion pose",
                category: "advanced",
                subcategory: "inversion",
                difficulty: "advanced",
                duration: "7:00",
                holds: "3 × 45s",
                videoCode: "cXrR7qRqRq4",
                benefit: "Strengthens shoulders, core",
                solution: "Improves balance and focus",
                focus: ["strength", "focus"]
            },
            {
                id: "A4",
                name: "King Pigeon Pose (Raja Kapotasana)",
                description: "Advanced backbend",
                category: "advanced",
                subcategory: "backbend",
                difficulty: "advanced",
                duration: "8:30",
                holds: "3 × 60s each side",
                videoCode: "dXrR7qRqRq4",
                benefit: "Deep hip and chest opening",
                solution: "Improves spinal flexibility",
                focus: ["flexibility", "strength"]
            },
            {
                id: "A5",
                name: "Scorpion Pose (Vrschikasana)",
                description: "Extreme backbend and balance",
                category: "advanced",
                subcategory: "inversion",
                difficulty: "advanced",
                duration: "9:00",
                holds: "3 × 30s",
                videoCode: "eXrR7qRqRq4",
                benefit: "Full body strength and flexibility",
                solution: "Advanced spinal opening",
                focus: ["strength", "flexibility"]
            },
            {
                id: "A6",
                name: "Eight-Angle Pose (Astavakrasana)",
                description: "Advanced arm balance",
                category: "advanced",
                subcategory: "arm_balance",
                difficulty: "advanced",
                duration: "7:45",
                holds: "3 × 30s each side",
                videoCode: "fXrR7qRqRq4",
                benefit: "Arm strength, core stability",
                solution: "Develops advanced coordination",
                focus: ["strength", "balance"]
            },
            {
                id: "A7",
                name: "Flying Pigeon Pose (Eka Pada Galavasana)",
                description: "Arm balance and hip opener",
                category: "advanced",
                subcategory: "arm_balance",
                difficulty: "advanced",
                duration: "8:15",
                holds: "3 × 30s each side",
                videoCode: "gXrR7qRqRq4",
                benefit: "Hip flexibility, arm strength",
                solution: "Combines strength and flexibility",
                focus: ["flexibility", "strength"]
            },
            {
                id: "A8",
                name: "Lotus Pose (Padmasana)",
                description: "Advanced meditation pose",
                category: "advanced",
                subcategory: "meditation",
                difficulty: "advanced",
                duration: "10:00",
                holds: "1 × 10:00",
                videoCode: "hXrR7qRqRq4",
                benefit: "Deep meditation posture",
                solution: "Improves hip flexibility for sitting",
                focus: ["focus", "flexibility"]
            }
        ],

        // 4️⃣ THERAPEUTIC & RESTORATIVE POSES (8 poses)
        therapeutic: [
            {
                id: "T1",
                name: "Legs-Up-The-Wall Pose (Viparita Karani)",
                description: "Gentle inversion for relaxation",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "10:00",
                holds: "1 × 10:00",
                videoCode: "gXrR7qRqRq4",
                benefit: "Reduces swelling, calms nervous system",
                solution: "Relieves tired legs and feet",
                focus: ["stress", "relaxation"]
            },
            {
                id: "T2",
                name: "Supine Twist (Supta Matsyendrasana)",
                description: "Spinal twist for back relief",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "8:00",
                holds: "2 × 60s each side",
                videoCode: "hXrR7qRqRq4",
                benefit: "Relieves back tension, improves digestion",
                solution: "Gentle spinal detoxification",
                focus: ["pain", "flexibility"]
            },
            {
                id: "T3",
                name: "Supported Bridge Pose",
                description: "Gentle backbend with support",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "7:00",
                holds: "3 × 90s",
                videoCode: "iXrR7qRqRq4",
                benefit: "Relieves lower back pain",
                solution: "Opens chest without strain",
                focus: ["pain", "flexibility"]
            },
            {
                id: "T4",
                name: "Reclining Bound Angle Pose (Supta Baddha Konasana)",
                description: "Hip and groin relaxation",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "8:30",
                holds: "1 × 8:00",
                videoCode: "jXrR7qRqRq4",
                benefit: "Opens hips, relieves tension",
                solution: "Calms nervous system",
                focus: ["stress", "flexibility"]
            },
            {
                id: "T5",
                name: "Supported Child's Pose",
                description: "Restorative version with props",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "5:00",
                holds: "3 × 60s",
                videoCode: "kXrR7qRqRq4",
                benefit: "Deep relaxation, stress relief",
                solution: "Releases back and hip tension",
                focus: ["stress", "relaxation"]
            },
            {
                id: "T6",
                name: "Fish Pose (Matsyasana)",
                description: "Chest opening for breathing",
                category: "therapeutic",
                subcategory: "backbend",
                difficulty: "beginner",
                duration: "5:30",
                holds: "3 × 60s",
                videoCode: "lXrR7qRqRq4",
                benefit: "Improves lung capacity, posture",
                solution: "Counteracts slumped posture",
                focus: ["posture", "flexibility"]
            },
            {
                id: "T7",
                name: "Supported Forward Fold",
                description: "Gentle hamstring stretch",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "6:00",
                holds: "3 × 90s",
                videoCode: "mXrR7qRqRq4",
                benefit: "Calms nervous system",
                solution: "Gentle hamstring release",
                focus: ["stress", "flexibility"]
            },
            {
                id: "T8",
                name: "Corpse Pose (Savasana)",
                description: "Complete relaxation pose",
                category: "therapeutic",
                subcategory: "restorative",
                difficulty: "beginner",
                duration: "15:00",
                holds: "1 × 15:00",
                videoCode: "nXrR7qRqRq4",
                benefit: "Deep relaxation, integration",
                solution: "Allows body to absorb benefits",
                focus: ["stress", "relaxation"]
            }
        ],

        // 5️⃣ FLEXIBILITY & MOBILITY POSES (8 poses)
        flexibility: [
            {
                id: "F1",
                name: "Lizard Pose (Utthan Pristhasana)",
                description: "Deep hip and groin stretch",
                category: "flexibility",
                subcategory: "hip_opener",
                difficulty: "intermediate",
                duration: "6:30",
                holds: "3 × 45s each side",
                videoCode: "mXrR7qRqRq4",
                benefit: "Improves hip flexibility",
                solution: "Releases tight hip flexors",
                focus: ["flexibility", "pain"]
            },
            {
                id: "F2",
                name: "Butterfly Pose (Baddha Konasana)",
                description: "Groin and inner thigh stretch",
                category: "flexibility",
                subcategory: "hip_opener",
                difficulty: "beginner",
                duration: "5:00",
                holds: "3 × 60s",
                videoCode: "nXrR7qRqRq4",
                benefit: "Increases hip flexibility",
                solution: "Improves blood circulation",
                focus: ["flexibility", "circulation"]
            },
            {
                id: "F3",
                name: "Camel to Rabbit Flow",
                description: "Spinal flexion and extension",
                category: "flexibility",
                subcategory: "spine",
                difficulty: "intermediate",
                duration: "7:00",
                holds: "5 cycles",
                videoCode: "oXrR7qRqRq4",
                benefit: "Improves spinal flexibility",
                solution: "Counterbalances backbends",
                focus: ["flexibility", "mobility"]
            },
            {
                id: "F4",
                name: "Thread the Needle Pose",
                description: "Shoulder and upper back stretch",
                category: "flexibility",
                subcategory: "upper_body",
                difficulty: "beginner",
                duration: "5:30",
                holds: "3 × 45s each side",
                videoCode: "pXrR7qRqRq4",
                benefit: "Relieves shoulder tension",
                solution: "Improves shoulder mobility",
                focus: ["flexibility", "pain"]
            },
            {
                id: "F5",
                name: "Dragon Pose",
                description: "Deep hip flexor stretch",
                category: "flexibility",
                subcategory: "hip_opener",
                difficulty: "intermediate",
                duration: "6:00",
                holds: "3 × 60s each side",
                videoCode: "qXrR7qRqRq4",
                benefit: "Releases tight hip flexors",
                solution: "Improves hip mobility",
                focus: ["flexibility", "mobility"]
            },
            {
                id: "F6",
                name: "Extended Puppy Pose",
                description: "Spine and shoulder stretch",
                category: "flexibility",
                subcategory: "upper_body",
                difficulty: "beginner",
                duration: "5:00",
                holds: "3 × 60s",
                videoCode: "rXrR7qRqRq4",
                benefit: "Stretches spine and shoulders",
                solution: "Relieves upper back tension",
                focus: ["flexibility", "stress"]
            },
            {
                id: "F7",
                name: "Half Splits (Ardha Hanumanasana)",
                description: "Hamstring stretch preparation",
                category: "flexibility",
                subcategory: "legs",
                difficulty: "intermediate",
                duration: "6:30",
                holds: "3 × 60s each side",
                videoCode: "sXrR7qRqRq4",
                benefit: "Improves hamstring flexibility",
                solution: "Prepares for full splits",
                focus: ["flexibility", "strength"]
            },
            {
                id: "F8",
                name: "Standing Forward Fold with Twist",
                description: "Combined hamstring and spine stretch",
                category: "flexibility",
                subcategory: "spine",
                difficulty: "intermediate",
                duration: "5:45",
                holds: "3 × 45s each side",
                videoCode: "tXrR7qRqRq4",
                benefit: "Improves full body flexibility",
                solution: "Combines multiple stretches",
                focus: ["flexibility", "mobility"]
            }
        ],

        // 6️⃣ BREATHWORK & MEDITATION (8 practices)
        breathwork: [
            {
                id: "BR1",
                name: "Ujjayi Pranayama",
                description: "Ocean breath for focus",
                category: "breathwork",
                subcategory: "pranayama",
                difficulty: "beginner",
                duration: "8:00",
                holds: "5 min practice",
                videoCode: "rXrR7qRqRq4",
                benefit: "Calms nervous system",
                solution: "Improves focus during practice",
                focus: ["focus", "stress"]
            },
            {
                id: "BR2",
                name: "Nadi Shodhana",
                description: "Alternate nostril breathing",
                category: "breathwork",
                subcategory: "pranayama",
                difficulty: "intermediate",
                duration: "10:00",
                holds: "5 min practice",
                videoCode: "sXrR7qRqRq4",
                benefit: "Balances left and right brain",
                solution: "Reduces anxiety and stress",
                focus: ["stress", "focus"]
            },
            {
                id: "BR3",
                name: "Kapalabhati Pranayama",
                description: "Skull shining breath",
                category: "breathwork",
                subcategory: "pranayama",
                difficulty: "intermediate",
                duration: "7:00",
                holds: "3 rounds of 30 breaths",
                videoCode: "vXrR7qRqRq4",
                benefit: "Energizes body and mind",
                solution: "Cleanses respiratory system",
                focus: ["energy", "focus"]
            },
            {
                id: "BR4",
                name: "Bhramari Pranayama",
                description: "Bee breath for relaxation",
                category: "breathwork",
                subcategory: "pranayama",
                difficulty: "beginner",
                duration: "6:00",
                holds: "5 min practice",
                videoCode: "wXrR7qRqRq4",
                benefit: "Calms mind, reduces stress",
                solution: "Relieves tension and anxiety",
                focus: ["stress", "relaxation"]
            },
            {
                id: "BR5",
                name: "Box Breathing",
                description: "Equal ratio breathing",
                category: "breathwork",
                subcategory: "modern",
                difficulty: "beginner",
                duration: "5:00",
                holds: "5 min practice",
                videoCode: "xXrR7qRqRq4",
                benefit: "Reduces stress, improves focus",
                solution: "Regulates nervous system",
                focus: ["stress", "focus"]
            },
            {
                id: "BR6",
                name: "4-7-8 Breathing",
                description: "Relaxation breathing technique",
                category: "breathwork",
                subcategory: "modern",
                difficulty: "beginner",
                duration: "5:00",
                holds: "5 min practice",
                videoCode: "yXrR7qRqRq4",
                benefit: "Promotes relaxation and sleep",
                solution: "Reduces anxiety quickly",
                focus: ["stress", "relaxation"]
            },
            {
                id: "BR7",
                name: "Mindfulness Meditation",
                description: "Present moment awareness",
                category: "breathwork",
                subcategory: "meditation",
                difficulty: "beginner",
                duration: "15:00",
                holds: "15 min practice",
                videoCode: "zXrR7qRqRq4",
                benefit: "Reduces stress, improves focus",
                solution: "Develops mental clarity",
                focus: ["focus", "stress"]
            },
            {
                id: "BR8",
                name: "Body Scan Meditation",
                description: "Progressive relaxation",
                category: "breathwork",
                subcategory: "meditation",
                difficulty: "beginner",
                duration: "12:00",
                holds: "12 min practice",
                videoCode: "aYrR7qRqRq4",
                benefit: "Reduces body tension",
                solution: "Improves body awareness",
                focus: ["relaxation", "stress"]
            }
        ],

        // 7️⃣ SPORTS & ATHLETIC PERFORMANCE (8 poses)
        athletic: [
            {
                id: "SP1",
                name: "Runner's Lunge Series",
                description: "Dynamic leg and hip opening",
                category: "athletic",
                subcategory: "dynamic",
                difficulty: "intermediate",
                duration: "8:00",
                holds: "3 × 30s each side",
                videoCode: "tXrR7qRqRq4",
                benefit: "Improves running efficiency",
                solution: "Prevents running injuries",
                focus: ["flexibility", "strength"]
            },
            {
                id: "SP2",
                name: "Warrior Flow for Athletes",
                description: "Dynamic strength building",
                category: "athletic",
                subcategory: "dynamic",
                difficulty: "intermediate",
                duration: "10:00",
                holds: "Flow sequence",
                videoCode: "uXrR7qRqRq4",
                benefit: "Builds functional strength",
                solution: "Improves athletic performance",
                focus: ["strength", "balance"]
            },
            {
                id: "SP3",
                name: "Hip Mobility for Athletes",
                description: "Dynamic hip opening",
                category: "athletic",
                subcategory: "mobility",
                difficulty: "intermediate",
                duration: "9:00",
                holds: "Dynamic sequence",
                videoCode: "zXrR7qRqRq4",
                benefit: "Improves hip mobility",
                solution: "Enhances athletic movement",
                focus: ["mobility", "flexibility"]
            },
            {
                id: "SP4",
                name: "Recovery Yoga for Athletes",
                description: "Post-workout recovery",
                category: "athletic",
                subcategory: "recovery",
                difficulty: "beginner",
                duration: "12:00",
                holds: "Gentle holds",
                videoCode: "aYrR7qRqRq4",
                benefit: "Speeds up recovery",
                solution: "Reduces muscle soreness",
                focus: ["recovery", "flexibility"]
            },
            {
                id: "SP5",
                name: "Balance Training for Sports",
                description: "Sport-specific balance",
                category: "athletic",
                subcategory: "balance",
                difficulty: "intermediate",
                duration: "8:30",
                holds: "Balance challenges",
                videoCode: "bYrR7qRqRq4",
                benefit: "Improves sports balance",
                solution: "Enhances proprioception",
                focus: ["balance", "focus"]
            },
            {
                id: "SP6",
                name: "Core Strength for Athletes",
                description: "Athletic core development",
                category: "athletic",
                subcategory: "strength",
                difficulty: "intermediate",
                duration: "10:00",
                holds: "Core sequence",
                videoCode: "cYrR7qRqRq4",
                benefit: "Builds athletic core",
                solution: "Improves power transfer",
                focus: ["strength", "core"]
            },
            {
                id: "SP7",
                name: "Shoulder Mobility for Sports",
                description: "Upper body mobility",
                category: "athletic",
                subcategory: "mobility",
                difficulty: "intermediate",
                duration: "9:00",
                holds: "Mobility sequence",
                videoCode: "dYrR7qRqRq4",
                benefit: "Improves shoulder health",
                solution: "Prevents shoulder injuries",
                focus: ["mobility", "strength"]
            },
            {
                id: "SP8",
                name: "Pre-Workout Activation",
                description: "Warm-up yoga sequence",
                category: "athletic",
                subcategory: "dynamic",
                difficulty: "beginner",
                duration: "7:00",
                holds: "Dynamic flow",
                videoCode: "eYrR7qRqRq4",
                benefit: "Prepares body for exercise",
                solution: "Reduces injury risk",
                focus: ["mobility", "warmup"]
            }
        ]
    };

    // ==================== QUESTIONS ====================
    const questions = [
        {
            id: 1,
            text: "What is your gender?",
            options: ["Male", "Female", "Prefer not to say"],
            category: "demographic",
            scoreMap: { "Male": 0, "Female": 0, "Prefer not to say": 0 }
        },
        {
            id: 2,
            text: "What is your current age?",
            options: ["Under 25", "25-34", "35-44", "45-54", "55-64", "65+"],
            category: "demographic",
            scoreMap: { "Under 25": 0, "25-34": 5, "35-44": 10, "45-54": 15, "55-64": 20, "65+": 25 }
        },
        {
            id: 3,
            text: "What is your primary reason for starting yoga?",
            options: ["Stress relief", "Flexibility", "Strength building", "Pain relief", "Spiritual growth", "Overall wellness"],
            category: "demographic",
            scoreMap: { "Stress relief": 20, "Flexibility": 15, "Strength building": 10, "Pain relief": 25, "Spiritual growth": 5, "Overall wellness": 0 }
        },
        {
            id: 4,
            text: "Any previous injuries or surgeries?",
            options: ["None", "Back injury", "Knee surgery", "Shoulder injury", "Hip issues", "Multiple injuries"],
            category: "demographic",
            scoreMap: { "None": 0, "Back injury": 25, "Knee surgery": 20, "Shoulder injury": 15, "Hip issues": 20, "Multiple injuries": 30 }
        },
        {
            id: 5,
            text: "Any chronic health conditions?",
            options: ["None", "Hypertension", "Diabetes", "Arthritis", "Asthma", "Multiple conditions"],
            category: "demographic",
            scoreMap: { "None": 0, "Hypertension": 15, "Diabetes": 20, "Arthritis": 25, "Asthma": 15, "Multiple conditions": 30 }
        },

        // Section 2: Current Health & Symptoms (10 questions)
        {
            id: 6,
            text: "How would you rate your current flexibility?",
            options: ["Very flexible", "Somewhat flexible", "Average", "Somewhat stiff", "Very stiff"],
            category: "symptoms",
            scoreMap: { "Very flexible": 0, "Somewhat flexible": 10, "Average": 20, "Somewhat stiff": 30, "Very stiff": 40 }
        },
        {
            id: 7,
            text: "Do you experience back pain?",
            options: ["Never", "Occasionally", "Weekly", "Daily", "Constant pain"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 10, "Weekly": 20, "Daily": 30, "Constant pain": 40 }
        },
        {
            id: 8,
            text: "Do you experience neck or shoulder tension?",
            options: ["Never", "Occasionally", "Weekly", "Daily", "Constant tension"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Occasionally": 10, "Weekly": 20, "Daily": 30, "Constant tension": 40 }
        },
        {
            id: 9,
            text: "How is your posture during daily activities?",
            options: ["Excellent posture", "Good posture", "Average", "Frequent slouching", "Poor posture always"],
            category: "symptoms",
            scoreMap: { "Excellent posture": 0, "Good posture": 10, "Average": 20, "Frequent slouching": 30, "Poor posture always": 40 }
        },
        {
            id: 10,
            text: "Do you experience joint pain?",
            options: ["No joint pain", "Knees occasionally", "Hips occasionally", "Multiple joints", "Chronic joint pain"],
            category: "symptoms",
            scoreMap: { "No joint pain": 0, "Knees occasionally": 15, "Hips occasionally": 15, "Multiple joints": 25, "Chronic joint pain": 35 }
        },
        {
            id: 11,
            text: "How is your balance during daily activities?",
            options: ["Excellent balance", "Good balance", "Average balance", "Sometimes unsteady", "Frequent balance issues"],
            category: "symptoms",
            scoreMap: { "Excellent balance": 0, "Good balance": 5, "Average balance": 15, "Sometimes unsteady": 25, "Frequent balance issues": 35 }
        },
        {
            id: 12,
            text: "Do you experience headaches or migraines?",
            options: ["Never", "Rarely", "Monthly", "Weekly", "Daily"],
            category: "symptoms",
            scoreMap: { "Never": 0, "Rarely": 5, "Monthly": 15, "Weekly": 25, "Daily": 35 }
        },
        {
            id: 13,
            text: "How is your digestion?",
            options: ["Excellent", "Good", "Average", "Poor", "Chronic issues"],
            category: "symptoms",
            scoreMap: { "Excellent": 0, "Good": 5, "Average": 15, "Poor": 25, "Chronic issues": 35 }
        },
        {
            id: 14,
            text: "Do you experience breathing difficulties?",
            options: ["None", "During exercise", "With allergies", "Asthma symptoms", "Chronic breathing issues"],
            category: "symptoms",
            scoreMap: { "None": 0, "During exercise": 10, "With allergies": 15, "Asthma symptoms": 25, "Chronic breathing issues": 35 }
        },
        {
            id: 15,
            text: "How is your sleep quality?",
            options: ["Excellent", "Good", "Average", "Poor", "Chronic insomnia"],
            category: "symptoms",
            scoreMap: { "Excellent": 0, "Good": 5, "Average": 15, "Poor": 25, "Chronic insomnia": 35 }
        },

        // Section 3: Lifestyle & Daily Habits (10 questions)
        {
            id: 16,
            text: "What is your occupation?",
            options: ["Sedentary (desk job)", "Standing job", "Light physical work", "Heavy physical work", "Athlete/Performer"],
            category: "lifestyle",
            scoreMap: { "Sedentary (desk job)": 25, "Standing job": 20, "Light physical work": 10, "Heavy physical work": 15, "Athlete/Performer": 5 }
        },
        {
            id: 17,
            text: "Hours sitting per day?",
            options: ["< 4 hours", "4-8 hours", "8-10 hours", "10-12 hours", "> 12 hours"],
            category: "lifestyle",
            scoreMap: { "< 4 hours": 0, "4-8 hours": 15, "8-10 hours": 25, "10-12 hours": 35, "> 12 hours": 40 }
        },
        {
            id: 18,
            text: "Regular exercise routine?",
            options: ["None", "1-2 times/week", "3-4 times/week", "5+ times/week", "Athlete training"],
            category: "lifestyle",
            scoreMap: { "None": 30, "1-2 times/week": 20, "3-4 times/week": 10, "5+ times/week": 5, "Athlete training": 0 }
        },
        {
            id: 19,
            text: "Type of exercise you regularly do?",
            options: ["None", "Walking", "Running/Cardio", "Weight training", "Team sports", "Mixed training"],
            category: "lifestyle",
            scoreMap: { "None": 30, "Walking": 10, "Running/Cardio": 15, "Weight training": 20, "Team sports": 15, "Mixed training": 5 }
        },
        {
            id: 20,
            text: "Daily stress level?",
            options: ["Very low", "Low", "Moderate", "High", "Very high"],
            category: "lifestyle",
            scoreMap: { "Very low": 0, "Low": 10, "Moderate": 20, "High": 30, "Very high": 40 }
        },
        {
            id: 21,
            text: "How do you manage stress?",
            options: ["Meditation/yoga", "Exercise", "Social activities", "No specific method", "Don't manage stress"],
            category: "lifestyle",
            scoreMap: { "Meditation/yoga": 0, "Exercise": 10, "Social activities": 15, "No specific method": 25, "Don't manage stress": 35 }
        },
        {
            id: 22,
            text: "Caffeine consumption?",
            options: ["None", "1 cup/day", "2-3 cups/day", "4-5 cups/day", "> 5 cups/day"],
            category: "lifestyle",
            scoreMap: { "None": 0, "1 cup/day": 5, "2-3 cups/day": 15, "4-5 cups/day": 25, "> 5 cups/day": 35 }
        },
        {
            id: 23,
            text: "Alcohol consumption?",
            options: ["None", "Occasionally", "Weekly", "Several times/week", "Daily"],
            category: "lifestyle",
            scoreMap: { "None": 0, "Occasionally": 10, "Weekly": 20, "Several times/week": 30, "Daily": 40 }
        },
        {
            id: 24,
            text: "Smoking or vaping?",
            options: ["Never", "Former smoker", "Occasionally", "Regular smoker", "Heavy smoker"],
            category: "lifestyle",
            scoreMap: { "Never": 0, "Former smoker": 15, "Occasionally": 25, "Regular smoker": 35, "Heavy smoker": 45 }
        },
        {
            id: 25,
            text: "Daily screen time (excluding work)?",
            options: ["< 1 hour", "1-2 hours", "3-4 hours", "5-6 hours", "> 6 hours"],
            category: "lifestyle",
            scoreMap: { "< 1 hour": 0, "1-2 hours": 10, "3-4 hours": 20, "5-6 hours": 30, "> 6 hours": 40 }
        },

        // Section 4: Yoga Experience & Goals (8 questions)
        {
            id: 26,
            text: "Previous yoga experience?",
            options: ["None", "Few classes", "Occasional practice", "Regular practice", "Yoga teacher"],
            category: "experience",
            scoreMap: { "None": 30, "Few classes": 20, "Occasional practice": 10, "Regular practice": 5, "Yoga teacher": 0 }
        },
        {
            id: 27,
            text: "Familiarity with basic yoga poses?",
            options: ["No knowledge", "Few poses", "Basic knowledge", "Good knowledge", "Expert knowledge"],
            category: "experience",
            scoreMap: { "No knowledge": 25, "Few poses": 15, "Basic knowledge": 10, "Good knowledge": 5, "Expert knowledge": 0 }
        },
        {
            id: 28,
            text: "What style of yoga interests you most?",
            options: ["Hatha (gentle)", "Vinyasa (flow)", "Iyengar (alignment)", "Restorative (relaxing)", "Power (intense)", "Not sure"],
            category: "experience",
            scoreMap: { "Hatha (gentle)": 5, "Vinyasa (flow)": 10, "Iyengar (alignment)": 5, "Restorative (relaxing)": 0, "Power (intense)": 20, "Not sure": 15 }
        },
        {
            id: 29,
            text: "Primary yoga goal?",
            options: ["Stress reduction", "Flexibility", "Strength building", "Pain relief", "Weight management", "Spiritual growth"],
            category: "goals",
            scoreMap: { "Stress reduction": 20, "Flexibility": 15, "Strength building": 10, "Pain relief": 25, "Weight management": 15, "Spiritual growth": 5 }
        },
        {
            id: 30,
            text: "Secondary yoga goals?",
            options: ["Better posture", "Improved sleep", "More energy", "Better balance", "Mental clarity", "All of above"],
            category: "goals",
            scoreMap: { "Better posture": 10, "Improved sleep": 15, "More energy": 10, "Better balance": 10, "Mental clarity": 10, "All of above": 20 }
        },
        {
            id: 31,
            text: "Time available for daily practice?",
            options: ["5-10 minutes", "15-20 minutes", "30 minutes", "45 minutes", "60+ minutes"],
            category: "goals",
            scoreMap: { "5-10 minutes": 25, "15-20 minutes": 15, "30 minutes": 5, "45 minutes": 0, "60+ minutes": 0 }
        },
        {
            id: 32,
            text: "Preferred practice time?",
            options: ["Morning", "Afternoon", "Evening", "Before bed", "Anytime"],
            category: "goals",
            scoreMap: { "Morning": 0, "Afternoon": 5, "Evening": 10, "Before bed": 5, "Anytime": 0 }
        },
        {
            id: 33,
            text: "Commitment level to 30-day program?",
            options: ["100% committed", "Very committed", "Moderately committed", "Somewhat committed", "Will try my best"],
            category: "goals",
            scoreMap: { "100% committed": 0, "Very committed": 5, "Moderately committed": 15, "Somewhat committed": 25, "Will try my best": 20 }
        },

        // Section 5: Physical Capabilities (7 questions)
        {
            id: 34,
            text: "Can you touch your toes?",
            options: ["Easily", "With slight bend", "Fingers to shins", "Can't reach shins", "Significant difficulty"],
            category: "physical",
            scoreMap: { "Easily": 0, "With slight bend": 10, "Fingers to shins": 20, "Can't reach shins": 30, "Significant difficulty": 40 }
        },
        {
            id: 35,
            text: "Can you hold a plank for 30 seconds?",
            options: ["Easily 60+ seconds", "Yes, 30 seconds", "With difficulty", "Less than 15 seconds", "Cannot do plank"],
            category: "physical",
            scoreMap: { "Easily 60+ seconds": 0, "Yes, 30 seconds": 10, "With difficulty": 20, "Less than 15 seconds": 30, "Cannot do plank": 40 }
        },
        {
            id: 36,
            text: "Balance on one leg with eyes closed?",
            options: ["30+ seconds", "15-30 seconds", "5-15 seconds", "Less than 5 seconds", "Cannot balance"],
            category: "physical",
            scoreMap: { "30+ seconds": 0, "15-30 seconds": 10, "5-15 seconds": 20, "Less than 5 seconds": 30, "Cannot balance": 40 }
        },
        {
            id: 37,
            text: "Comfort level with kneeling positions?",
            options: ["Very comfortable", "Comfortable", "Some discomfort", "Painful", "Cannot kneel"],
            category: "physical",
            scoreMap: { "Very comfortable": 0, "Comfortable": 10, "Some discomfort": 20, "Painful": 30, "Cannot kneel": 40 }
        },
        {
            id: 38,
            text: "Comfort level with sitting cross-legged?",
            options: ["Very comfortable", "Comfortable", "Some discomfort", "Painful", "Cannot sit cross-legged"],
            category: "physical",
            scoreMap: { "Very comfortable": 0, "Comfortable": 10, "Some discomfort": 20, "Painful": 30, "Cannot sit cross-legged": 40 }
        },
        {
            id: 39,
            text: "Upper body strength for push-ups?",
            options: ["10+ push-ups", "5-10 push-ups", "1-5 push-ups", "Knee push-ups only", "Cannot do push-ups"],
            category: "physical",
            scoreMap: { "10+ push-ups": 0, "5-10 push-ups": 10, "1-5 push-ups": 20, "Knee push-ups only": 30, "Cannot do push-ups": 40 }
        },
        {
            id: 40,
            text: "Lower body strength for squats?",
            options: ["20+ squats", "10-20 squats", "5-10 squats", "1-5 squats", "Difficulty with squats"],
            category: "physical",
            scoreMap: { "20+ squats": 0, "10-20 squats": 10, "5-10 squats": 20, "1-5 squats": 30, "Difficulty with squats": 40 }
        },

        // Section 6: Mental & Emotional Health (10 questions)
        {
            id: 41,
            text: "Current stress management?",
            options: ["Excellent", "Good", "Average", "Poor", "No management"],
            category: "mental",
            scoreMap: { "Excellent": 0, "Good": 10, "Average": 20, "Poor": 30, "No management": 40 }
        },
        {
            id: 42,
            text: "Ability to focus and concentrate?",
            options: ["Excellent focus", "Good focus", "Average", "Poor focus", "Difficulty focusing"],
            category: "mental",
            scoreMap: { "Excellent focus": 0, "Good focus": 10, "Average": 20, "Poor focus": 30, "Difficulty focusing": 40 }
        },
        {
            id: 43,
            text: "Quality of sleep?",
            options: ["Deep restful sleep", "Generally good sleep", "Interrupted sleep", "Light sleep", "Chronic insomnia"],
            category: "mental",
            scoreMap: { "Deep restful sleep": 0, "Generally good sleep": 10, "Interrupted sleep": 20, "Light sleep": 30, "Chronic insomnia": 40 }
        },
        {
            id: 44,
            text: "Energy levels throughout day?",
            options: ["Consistent energy", "Morning energy", "Afternoon slump", "Low energy", "Chronic fatigue"],
            category: "mental",
            scoreMap: { "Consistent energy": 0, "Morning energy": 10, "Afternoon slump": 20, "Low energy": 30, "Chronic fatigue": 40 }
        },
        {
            id: 45,
            text: "Mood stability?",
            options: ["Very stable", "Generally stable", "Some fluctuations", "Frequent mood swings", "Unstable moods"],
            category: "mental",
            scoreMap: { "Very stable": 0, "Generally stable": 10, "Some fluctuations": 20, "Frequent mood swings": 30, "Unstable moods": 40 }
        },
        {
            id: 46,
            text: "Anxiety levels?",
            options: ["No anxiety", "Mild occasional", "Moderate anxiety", "High anxiety", "Severe anxiety"],
            category: "mental",
            scoreMap: { "No anxiety": 0, "Mild occasional": 10, "Moderate anxiety": 20, "High anxiety": 30, "Severe anxiety": 40 }
        },
        {
            id: 47,
            text: "Meditation experience?",
            options: ["Daily practice", "Weekly practice", "Occasional", "Tried few times", "No experience"],
            category: "mental",
            scoreMap: { "Daily practice": 0, "Weekly practice": 5, "Occasional": 15, "Tried few times": 25, "No experience": 35 }
        },
        {
            id: 48,
            text: "Breath awareness?",
            options: ["Always aware", "Often aware", "Sometimes aware", "Rarely aware", "Never aware"],
            category: "mental",
            scoreMap: { "Always aware": 0, "Often aware": 10, "Sometimes aware": 20, "Rarely aware": 30, "Never aware": 40 }
        },
        {
            id: 49,
            text: "Mind-body connection awareness?",
            options: ["Strong connection", "Good connection", "Some awareness", "Little awareness", "No awareness"],
            category: "mental",
            scoreMap: { "Strong connection": 0, "Good connection": 10, "Some awareness": 20, "Little awareness": 30, "No awareness": 40 }
        },
        {
            id: 50,
            text: "Motivation for personal growth?",
            options: ["Extremely motivated", "Very motivated", "Moderately motivated", "Somewhat motivated", "Low motivation"],
            category: "mental",
            scoreMap: { "Extremely motivated": 0, "Very motivated": 5, "Moderately motivated": 15, "Somewhat motivated": 25, "Low motivation": 35 }
        }
    ];

    // ==================== CORE APP LOGIC ====================
    let youtubePlayer = null;
    let videoCheckInterval = null;
    let currentVideoId = null;
    
    function initApp() {
        const hasSavedData = loadState();
        if (hasSavedData) {
            if (appState.dayExercises && Object.keys(appState.dayExercises).length > 0) {
                showExercisePlan();
            } else {
                renderQuestion();
            }
        } else {
            renderQuestion();
        }
    }

    function renderQuestion() {
        if (appState.currentQuestion >= questions.length) {
            completeAssessment();
            return;
        }

        const q = questions[appState.currentQuestion];
        document.getElementById('question-text').textContent = q.text;
        
        const currentQNum = (appState.currentQuestion + 1).toString().padStart(2, '0');
        document.getElementById('question-counter').textContent = `${currentQNum}/${questions.length}`;
        
        const progress = ((appState.currentQuestion) / questions.length) * 100;
        document.getElementById('progress-bar').style.width = `${progress}%`;

        const container = document.getElementById('options-container');
        container.innerHTML = '';

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = "w-full btn-tech p-4 rounded-xl text-sm font-semibold text-left text-white flex justify-between items-center group";
            btn.innerHTML = `<span>${opt}</span><i class="far fa-circle text-white/20 group-hover:text-[#00FF41] transition-colors"></i>`;
            btn.onclick = () => handleAnswer(opt, q);
            container.appendChild(btn);
        });

        saveState();
    }

    function handleAnswer(answer, question) {
        appState.userProfile[`q${question.id}`] = answer;
        
        // Logic for specialized plans
        if (question.id === 2) {
            if (answer.includes("Flexibility")) appState.scores.flexibility += 20;
            if (answer.includes("Strength")) appState.scores.strength += 20;
            if (answer.includes("Stress")) appState.scores.stress += 20;
        }

        if (question.id === 5) {
            // Specific target Logic
            if (answer.includes("Hip")) appState.targetArea = "hips";
            else if (answer.includes("Core")) appState.targetArea = "core";
            else if (answer.includes("Balance")) appState.targetArea = "balance";
            else if (answer.includes("Relaxation")) appState.targetArea = "relax";
            else appState.targetArea = "full_body";
        }
        
        appState.currentQuestion++;
        renderQuestion();
    }

    function completeAssessment() {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('progress-section').classList.add('hidden');
        document.getElementById('analysis-section').classList.remove('hidden');
        
        generate30DayProgram();
        
        // Fake Score Animation
        animateScore('focus-score', 95);
        animateScore('wellness-score', 88);
        animateScore('program-score', 100);
        
        let planType = "GENERAL FLOW";
        if (appState.targetArea === "hips") planType = "HIP OPENING & MOBILITY";
        else if (appState.targetArea === "core") planType = "POWER YOGA CORE";
        else if (appState.targetArea === "relax") planType = "RESTORATIVE YOGA";
        else if (appState.targetArea === "balance") planType = "BALANCE & STABILITY";
        
        document.getElementById('analysis-text').textContent = 
            `Analyzing biometric data... Based on your profile, ` +
            `we have generated a ${planType} PROTOCOL. ` +
            `This 30-day cycle focuses on aligning your physical and mental wellness through targeted asanas.`;
        
        saveState();
    }

    function generate30DayProgram() {
        if (Object.keys(appState.dayExercises).length > 0) return;

        for (let day = 1; day <= 30; day++) {
            let dailyRoutine = [];
            
            // LOGIC FOR SPECIFIC TARGETS
            if (appState.targetArea === "hips") {
                dailyRoutine.push(...getSafe(yogaLibrary.flexibility, 3));
                dailyRoutine.push(...getSafe(yogaLibrary.beginner, 2));
                dailyRoutine.push(...getSafe(yogaLibrary.stress_relief, 1));
            } 
            else if (appState.targetArea === "core") {
                dailyRoutine.push(...getSafe(yogaLibrary.strength, 3));
                dailyRoutine.push(...getSafe(yogaLibrary.beginner, 1));
                dailyRoutine.push(...getSafe(yogaLibrary.flexibility, 1));
                dailyRoutine.push(...getSafe(yogaLibrary.stress_relief, 1));
            }
            else if (appState.targetArea === "relax") {
                dailyRoutine.push(...getSafe(yogaLibrary.stress_relief, 3));
                dailyRoutine.push(...getSafe(yogaLibrary.flexibility, 2));
                dailyRoutine.push(...getSafe(yogaLibrary.beginner, 1));
            }
            else if (appState.targetArea === "balance") {
                dailyRoutine.push(...getSafe(yogaLibrary.balance, 2));
                dailyRoutine.push(...getSafe(yogaLibrary.strength, 2));
                dailyRoutine.push(...getSafe(yogaLibrary.beginner, 2));
            }
            else {
                // Full Body
                dailyRoutine.push(...getSafe(yogaLibrary.beginner, 2));
                dailyRoutine.push(...getSafe(yogaLibrary.strength, 1));
                dailyRoutine.push(...getSafe(yogaLibrary.flexibility, 1));
                dailyRoutine.push(...getSafe(yogaLibrary.balance, 1));
                dailyRoutine.push(...getSafe(yogaLibrary.stress_relief, 1));
            }
            
            appState.dayExercises[day] = shuffle(dailyRoutine).slice(0, 6);
            appState.dayProgress[day] = [];
        }
    }

    function getSafe(arr, count) {
        if (!arr) return [];
        return shuffle([...arr]).slice(0, count);
    }

    function showExercisePlan() {
        document.getElementById('quiz-section').classList.add('hidden');
        document.getElementById('analysis-section').classList.add('hidden');
        document.getElementById('progress-section').classList.add('hidden');
        document.getElementById('exercise-section').classList.remove('hidden');
        document.getElementById('floating-reset-btn').classList.remove('hidden');
        
        renderExerciseList();
        saveState();
    }

    function renderExerciseList() {
        const list = document.getElementById('exercise-list');
        list.innerHTML = '';
        
        const day = appState.currentDay;
        document.getElementById('current-day').textContent = day.toString().padStart(2, '0');
        
        const exercises = appState.dayExercises[day] || [];
        const completed = appState.dayProgress[day] || [];
        
        document.getElementById('completion-stats').textContent = `${completed.length}/${exercises.length} POSES`;

        exercises.forEach((ex, idx) => {
            const isDone = completed.includes(ex.id);
            const isCurrent = idx === completed.length;
            const isLocked = idx > completed.length;

            const card = document.createElement('div');
            card.className = `exercise-card p-4 rounded-xl flex items-center gap-4 ${isLocked ? 'locked' : ''} ${isCurrent ? 'current' : ''} ${isDone ? 'completed' : ''} animate-fade-in group`;
            
            let iconColor = isDone ? 'bg-[#10b981] text-black' : (isLocked ? 'bg-white/10 text-white/30' : 'bg-[#00FF41] text-black');
            let icon = isDone ? '<i class="fas fa-check"></i>' : (isLocked ? '<i class="fas fa-lock"></i>' : idx + 1);

            card.innerHTML = `
                <div class="w-10 h-10 rounded-lg flex items-center justify-center font-bold font-mono-tech ${iconColor} transition-all shrink-0 shadow-lg">
                    ${icon}
                </div>
                <div class="flex-1 min-w-0">
                    <h4 class="text-sm font-bold text-white group-hover:text-[#00FF41] transition-colors truncate">${ex.name}</h4>
                    <p class="text-[9px] text-gray-400 uppercase font-mono-tech tracking-wider mt-1 truncate">
                        ${ex.category} <span class="text-[#00FF41]">•</span> ${ex.duration}
                    </p>
                </div>
                ${!isLocked && !isDone ? '<div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center shrink-0 border border-white/10"><i class="fas fa-play text-[#00FF41] text-xs"></i></div>' : ''}
            `;
            
            if (!isLocked && !isDone) {
                card.onclick = () => openVideo(ex, idx);
                card.style.cursor = 'pointer';
            }
            list.appendChild(card);
        });
    }

    let activeEx = null;
    let videoCompleted = false;
    
    function openVideo(ex, idx) {
        activeEx = ex;
        videoCompleted = false;
        
        document.getElementById('video-title').textContent = ex.name;
        document.getElementById('video-description').textContent = ex.description;
        document.getElementById('video-duration').textContent = ex.duration;
        document.getElementById('video-reps').textContent = ex.reps;
        document.getElementById('video-category').textContent = ex.category;
        
        const frame = document.getElementById('video-frame');
        // YouTube embed
        frame.innerHTML = `
            <iframe 
                id="youtube-player"
                src="https://www.youtube.com/embed/${ex.videoCode}?enablejsapi=1&rel=0&modestbranding=1&playsinline=1&controls=0" 
                class="absolute top-0 left-0 w-full h-full object-cover"
                frameborder="0" 
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                allowfullscreen>
            </iframe>`;
        
        document.getElementById('video-progress-fill').style.width = '0%';
        document.getElementById('video-time-current').textContent = '0:00';
        document.getElementById('video-time-total').textContent = '0:00';
        
        const completeBtn = document.getElementById('complete-btn');
        completeBtn.disabled = true;
        document.getElementById('complete-btn-text').textContent = 'SESSION IN PROGRESS...';
        document.getElementById('video-loading').classList.remove('hidden');
        
        document.getElementById('video-modal').classList.remove('hidden');
        
        if (!window.YT) {
            const tag = document.createElement('script');
            tag.src = "https://www.youtube.com/iframe_api";
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        } else if (window.YT && YT.Player) {
            createPlayer();
        }
        
        if (videoCheckInterval) clearInterval(videoCheckInterval);
        videoCheckInterval = setInterval(checkVideoProgress, 1000);
    }

    function createPlayer() {
        youtubePlayer = new YT.Player('youtube-player', {
            events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
        });
    }

    window.onYouTubeIframeAPIReady = function() {
        if(!document.getElementById('video-modal').classList.contains('hidden')) createPlayer();
    };

    function onPlayerReady(event) {
        document.getElementById('video-loading').classList.add('hidden');
        const duration = event.target.getDuration();
        updateTimeDisplay(duration, 'video-time-total');
    }

    function onPlayerStateChange(event) {
        if (event.data === YT.PlayerState.ENDED) {
            videoCompleted = true;
            enableCompleteButton();
        }
    }

    function checkVideoProgress() {
        if (youtubePlayer && youtubePlayer.getCurrentTime && youtubePlayer.getDuration) {
            const currentTime = youtubePlayer.getCurrentTime();
            const duration = youtubePlayer.getDuration();
            if (duration > 0) {
                const progressPercent = (currentTime / duration) * 100;
                document.getElementById('video-progress-fill').style.width = `${progressPercent}%`;
                updateTimeDisplay(currentTime, 'video-time-current');
                if (progressPercent >= 90 && !videoCompleted) {
                    videoCompleted = true;
                    enableCompleteButton();
                }
            }
        }
    }

    function updateTimeDisplay(time, elementId) {
        const minutes = Math.floor(time / 60);
        const seconds = Math.floor(time % 60);
        document.getElementById(elementId).textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
    }

    function enableCompleteButton() {
        const completeBtn = document.getElementById('complete-btn');
        completeBtn.disabled = false;
        document.getElementById('complete-btn-text').textContent = 'COMPLETE & SYNC DATA';
        document.getElementById('video-progress-fill').style.width = '100%';
    }

    function markCurrentExerciseComplete() {
        if (!activeEx || !videoCompleted) return;
        
        const day = appState.currentDay;
        if (!appState.dayProgress[day].includes(activeEx.id)) {
            appState.dayProgress[day].push(activeEx.id);
        }

        if (appState.dayProgress[day].length === appState.dayExercises[day].length && day < 30) {
            appState.currentDay++;
        }

        closeVideoModal();
        renderExerciseList();
        saveState();
    }

    function closeVideoModal() {
        if (videoCheckInterval) clearInterval(videoCheckInterval);
        if (youtubePlayer && youtubePlayer.stopVideo) { try { youtubePlayer.stopVideo(); } catch(e){} youtubePlayer = null; }
        document.getElementById('video-modal').classList.add('hidden');
        document.getElementById('video-frame').innerHTML = '';
        activeEx = null; videoCompleted = false;
    }

    // === RESET SYSTEM FUNCTIONS ===
    function restartAssessment() {
        document.getElementById('custom-alert-modal').classList.remove('hidden');
    }
    function confirmReset() {
        localStorage.removeItem('STIPRO_YOGA_GREEN_DATA');
        location.reload();
    }
    function cancelReset() {
        document.getElementById('custom-alert-modal').classList.add('hidden');
    }

    function shuffle(array) { 
        const shuffled = [...array];
        for (let i = shuffled.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
        }
        return shuffled;
    }
    
    function animateScore(id, target) {
        let cur = 0;
        const el = document.getElementById(id);
        const iv = setInterval(() => {
            cur += 2;
            if (cur >= target) { el.textContent = target + '%'; clearInterval(iv); }
            else { el.textContent = cur + '%'; }
        }, 20);
    }

    window.onload = initApp;
</script>
</body>
</html>
